<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>assignment2</title>
		<style>
			body { margin: 0; }
		</style>
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.147.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.147.0/examples/jsm/"
          }
        }
    </script>
	</head>
	<body>
		<h1 style="text-align: center;">Assignment 2</h1>

		<h2>Overview</h2>
		<p>Here is the checklist for the assignment:
			<ul>
				<li>Implement the structure-from-motion algorithm with the start code. &#10004 </li>
				<li>Write up your project, algorithms, reporting results (reprojection error) and visualisations (point cloud and camera pose), compare your reconstruction with open source software Colmap. &#10004</li>
				<li>Extra credit: Experiment with outlier filtering techniques. &#10004</li>
			</ul>
			
			There are more results could be found in folder: assets/assignment2.
		</p>
		
		<h2>Algorithm and Implementation</h2>
		<h3>Structure from Motion</h3>
		<p>
			Here is the pseudo code I used for SFM algorithm, more details could be found in comments of the code:
			<ul>
				<li>Select the first two images for initial pose estimation and triangulation.</li>
				<li>Perform baseline triangulation for the first two images.</li>
				<li>Generate a 3D point cloud and evaluate reprojection error for the initial pair of images.</li>
				<li>For each remaining image: 
					<ul>
						<li>Estimate the new camera pose.</li>
						<li>Triangulate points from the new view.</li>
						<li>Update the 3D point cloud and compute reprojection error for the new camera.</li>
					</ul>
			</ul>
		</p>

		<h3>Compute Reprojection Error</h3>
		<p>
			To compute the reprojection error, I used the following steps:
			<ul>
				<li>Extract image data, load features, and filter out invalid 3D point references.</li>
				<li>Compute 3D points from valid references and project these points onto the image.</li>
				<li>Calculate the errors between the original 2D points and the projected 2D points, and filter out outlier errors.</li>
				<li>Calculate average reprojection error.</li>
				<li>Plot the final result.</li>
			</ul>
		</p>
		
		<h3>Triangulate New View</h3>
		<p>
			I tried many different outlier filtering techniques, including RANSAC, dynamical range thresholding, and reprojection error filtering. I found that the best results were achieved by using a combination of reprojection error filtering and depth filtering.
			<br><br>
			For each new view, I used the following steps to triangulate the points:
			<ul>
				<li>Iterates through all previous views to find feature matches with the new view.</li>
				<li>Filters matches to include only those not already associated with a point in the point cloud.</li>
				<li>For each pair of views with valid matches:
					<ul>
						<li>Aligns the matched features and extracts corresponding 2D points from both images.</li>
						<li>Performs triangulation to generate new 3D points between the two views.</li>
						<li>Filters newly triangulated points based on reprojection error and position within dynamically defined ranges.</li>
						<li>Updates the global point cloud and reference indices for the new view with valid points.</li>
					</ul>
				</li>
			</ul>
		</p>

		<h2>Comparsion</h2>
		<h3>Compare with resuly using colmap</h3>
		<p>
			I compare the result of my implementation with the result of Colmap. The results are similar, but there are some differences in the point cloud and camera pose. Beacuse Colmap uses more advanced techniques and optimizations, it produces a more accurate reconstruction with less noise. But my implementation is able to reconstruct more details of the scene, like the texture of the wall and statue.

			<br><br>

			Here is the comparison of the point cloud and camera pose between my implementation and Colmap for the fountain dataset:
			
			<h3>Mine</h3>
			Mean Reprojection Error = 0.5122 [t=5.8s]
			<div class="inline-block">
				<img src="../assets/assignment2/fountain-P11-1.png" style='height: 40%; width: 40%;'>
				<img src="../assets/assignment2/fountain-P11-2.png" style='height: 40%; width: 40%;'>
			</div>
			
			<h3>Colmap</h3>
			Mean Reprojection Error = 0.4278 [t=3.3s]

			<div class="inline-block">
				<img src="../assets/assignment2/fountain-P11-colmap-1.png" style='height: 40%; width: 40%;'>
				<img src="../assets/assignment2/fountain-P11-colmap-2.png" style='height: 40%; width: 40%;'>
			</div>

		</p>


		<h2>Showcases</h2>
			<h3>Fountain-P11 Point Cloud Viewer</h3>
			<div id="container1"></div>

			<h3>Fountain-P11 Reprojection Error Images</h3>
			Mean Reprojection Error = 0.5122 [t=5.8s]
			<br><br>
			<div class="inline-block">
				<img src="../assets/assignment2/fountain-P11/errors/0000.png" style='height: 40%; width: 40%;'>
				<img src="../assets/assignment2/fountain-P11/errors/0008.png" style='height: 40%; width: 40%;'>
			</div>

			<h3>Herz-Jesus-P8 Point Cloud Viewer</h3>
			<div id="container2"></div>
			
			<h3>Herz-Jesus-P8 Images</h3>
			Mean Reprojection Error = 1.086 [t=3.0s]
			<br><br>
			<br><br>
			<div class="inline-block">
				<img src="../assets/assignment2/Herz-Jesus-P8-1.png" style='height: 40%; width: 40%;'>
				<img src="../assets/assignment2/Herz-Jesus-P8-2.png" style='height: 40%; width: 40%;'>
				<img src="../assets/assignment2/Herz-Jesus-P8-1-error.png" style='height: 40%; width: 40%;'>
				<img src="../assets/assignment2/Herz-Jesus-P8-2-error.png" style='height: 40%; width: 40%;'>
			</div>

		<script type="module" src="../writeup/assignment2.js"></script>
	</body>
</html>